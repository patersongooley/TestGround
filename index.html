<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Transcript Phrase Timestamp Finder</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f0f0f;
  color: #eee;
  padding: 20px;
}
textarea, input, button {
  width: 100%;
  margin: 8px 0;
  padding: 10px;
  font-size: 14px;
}
button {
  background: #4CAF50;
  color: #000;
  border: none;
  cursor: pointer;
}
.result {
  background: #1e1e1e;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
}
.timestamp {
  font-weight: bold;
}
mark {
  background: #4CAF50;
  color: black;
}
small {
  color: #aaa;
}
</style>
</head>

<body>

<h2>Transcript Phrase Timestamp Finder</h2>

<label>YouTube Video ID (optional, for clickable links)</label>
<input id="videoId" placeholder="e.g. dQw4w9WgXcQ">

<label>Transcript(s)</label>
<textarea id="transcript" rows="12"
placeholder="[00:12] Hello everyone...
[00:18] Talking about AI

--- VIDEO ---

[01:02] Second video starts here"></textarea>

<label>Word or Phrase</label>
<input id="phrase" placeholder="artificial intelligence">

<button onclick="findMatches()">Find Timestamps</button>

<div id="output"></div>

<script>
function findMatches() {
  const transcriptText = document.getElementById("transcript").value;
  const phrase = document.getElementById("phrase").value.trim();
  const videoId = document.getElementById("videoId").value.trim();
  const output = document.getElementById("output");

  output.innerHTML = "";
  if (!phrase) return;

  const videos = transcriptText.split(/---\s*VIDEO\s*---/i);
  const regexPhrase = new RegExp(phrase, "gi");

  videos.forEach((video, index) => {
    const lines = video.split("\n");
    let foundAny = false;

    lines.forEach(line => {
      const match = line.match(/\[(\d+:\d+:\d+|\d+:\d+)\]\s*(.*)/);
      if (!match) return;

      const time = match[1];
      const text = match[2];

      if (regexPhrase.test(text)) {
        foundAny = true;
        const highlighted = text.replace(regexPhrase, m => `<mark>${m}</mark>`);
        const seconds = toSeconds(time);

        const link = videoId
          ? `https://youtu.be/${videoId}?t=${seconds}`
          : null;

        output.innerHTML += `
          <div class="result">
            <span class="timestamp">⏱ ${time}</span>
            ${link ? `— <a target="_blank" href="${link}">Jump</a>` : ""}
            <br>
            <small>${highlighted}</small>
          </div>
        `;
      }
    });

    if (foundAny && videos.length > 1) {
      output.innerHTML += `<hr>`;
    }
  });
}

function toSeconds(time) {
  const parts = time.split(":").map(Number);
  return parts.reduce((acc, val) => acc * 60 + val, 0);
}
</script>

</body>
</html>
